{"ast":null,"code":"import \"antd-mobile/lib/flex/style/css\";\nimport _Flex from \"antd-mobile/lib/flex\";\nimport \"antd-mobile/lib/textarea-item/style/css\";\nimport _TextareaItem from \"antd-mobile/lib/textarea-item\";\nimport \"antd-mobile/lib/image-picker/style/css\";\nimport _ImagePicker from \"antd-mobile/lib/image-picker\";\nimport \"antd-mobile/lib/picker/style/css\";\nimport _Picker from \"antd-mobile/lib/picker\";\nimport \"antd-mobile/lib/input-item/style/css\";\nimport _InputItem from \"antd-mobile/lib/input-item\";\nimport \"antd-mobile/lib/nav-bar/style/css\";\nimport _NavBar from \"antd-mobile/lib/nav-bar\";\nimport \"antd-mobile/lib/icon/style/css\";\nimport _Icon from \"antd-mobile/lib/icon\";\nimport \"antd-mobile/lib/list/style/css\";\nimport _List from \"antd-mobile/lib/list\";\nimport \"antd-mobile/lib/toast/style/css\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport \"antd-mobile/lib/modal/style/css\";\nimport _Modal from \"antd-mobile/lib/modal\";\nvar _jsxFileName = \"F:\\\\\\u767E\\u5EA6\\u4E91\\u4E0B\\u8F7D\\\\React\\\\hkzf\\\\haokezufang\\\\src\\\\pages\\\\Rent\\\\Add\\\\index.js\";\nimport React, { Component } from 'react';\nimport HousePackage from '../../../components/HousePackage';\nimport styles from './index.module.css';\nimport { uploadHouseImgs, pubHouse } from '../../../utils/api/user';\nconst alert = _Modal.alert; // 房屋类型\n\nconst roomTypeData = [{\n  label: '一室',\n  value: 'ROOM|d4a692e4-a177-37fd'\n}, {\n  label: '二室',\n  value: 'ROOM|d1a00384-5801-d5cd'\n}, {\n  label: '三室',\n  value: 'ROOM|20903ae0-c7bc-f2e2'\n}, {\n  label: '四室',\n  value: 'ROOM|ce2a5daa-811d-2f49'\n}, {\n  label: '四室+',\n  value: 'ROOM|2731c38c-5b19-ff7f'\n}]; // 朝向：\n\nconst orientedData = [{\n  label: '东',\n  value: 'ORIEN|141b98bf-1ad0-11e3'\n}, {\n  label: '西',\n  value: 'ORIEN|103fb3aa-e8b4-de0e'\n}, {\n  label: '南',\n  value: 'ORIEN|61e99445-e95e-7f37'\n}, {\n  label: '北',\n  value: 'ORIEN|caa6f80b-b764-c2df'\n}, {\n  label: '东南',\n  value: 'ORIEN|dfb1b36b-e0d1-0977'\n}, {\n  label: '东北',\n  value: 'ORIEN|67ac2205-7e0f-c057'\n}, {\n  label: '西南',\n  value: 'ORIEN|2354e89e-3918-9cef'\n}, {\n  label: '西北',\n  value: 'ORIEN|80795f1a-e32f-feb9'\n}]; // 楼层\n\nconst floorData = [{\n  label: '高楼层',\n  value: 'FLOOR|1'\n}, {\n  label: '中楼层',\n  value: 'FLOOR|2'\n}, {\n  label: '低楼层',\n  value: 'FLOOR|3'\n}];\nexport default class RentAdd extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getInputVal = (name, val) => {\n      console.log(name, val);\n      this.setState({\n        [name]: val\n      });\n    };\n\n    this.selPack = selNames => {\n      console.log(selNames);\n      this.setState({\n        supporting: selNames.join('|')\n      });\n    };\n\n    this.getImg = (files, operationType, index) => {\n      console.log(files, operationType, index);\n      this.setState({\n        tempSlides: files\n      });\n    };\n\n    this.onCancel = () => {\n      alert('提示', '放弃发布房源?', [{\n        text: '放弃',\n        onPress: async () => this.props.history.go(-1)\n      }, {\n        text: '继续编辑'\n      }]);\n    };\n\n    this.addHouse = async () => {\n      const {\n        tempSlides,\n        title,\n        description,\n        oriented,\n        supporting,\n        price,\n        roomType,\n        size,\n        floor,\n        community\n      } = this.state; // 处理边界\n\n      if (!title || !size || !price) {\n        return _Toast.info('请输入房源基本信息！', 1);\n      } // 上传图片，获取上传位置\n\n\n      let houseImg;\n\n      if (tempSlides.length) {\n        let fm = new FormData();\n        tempSlides.forEach(item => fm.append('file', item.file));\n        let res = await uploadHouseImgs(fm);\n        console.log(res);\n\n        if (res.status === 200) {\n          houseImg = res.data.join('|');\n        } else {\n          _Toast.fail(res.description, 2);\n        }\n      } // 处理其它数据\n\n\n      const otd = {\n        title,\n        description,\n        houseImg,\n        oriented,\n        supporting,\n        price,\n        roomType,\n        size,\n        floor,\n        community: community.id\n      };\n      let ores = await pubHouse(otd);\n      console.log('form all data:', otd);\n\n      if (ores.status === 200) {\n        _Toast.success('发布成功！', 1, () => {\n          this.props.history.push('/rent');\n        });\n      } else {\n        if (ores.status === 400) {\n          _Toast.info('请重新登录！', 1, () => {\n            // 传入回跳地址\n            this.props.history.push('/login', {\n              backUrl: this.props.location.pathname\n            });\n          });\n        }\n      }\n    };\n\n    const {\n      state = {}\n    } = this.props.location;\n    this.state = {\n      // 临时图片地址\n      tempSlides: [],\n      // 小区的名称和id\n      community: {\n        name: state.name,\n        id: state.id\n      },\n      // 价格\n      price: '',\n      // 面积\n      size: '',\n      // 房屋类型\n      roomType: '',\n      // 楼层\n      floor: '',\n      // 朝向：\n      oriented: '',\n      // 房屋标题\n      title: '',\n      // 房屋图片\n      houseImg: '',\n      // 房屋配套：\n      supporting: '',\n      // 房屋描述\n      description: ''\n    };\n  } // 获取输入的值\n\n\n  render() {\n    const Item = _List.Item;\n    const {\n      history\n    } = this.props;\n    const {\n      community,\n      price,\n      size,\n      roomType,\n      floor,\n      oriented,\n      description,\n      tempSlides,\n      title\n    } = this.state;\n    return React.createElement(\"div\", {\n      className: styles.root,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, React.createElement(_NavBar, {\n      className: styles.navHeader,\n      icon: React.createElement(_Icon, {\n        type: \"left\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }),\n      mode: \"dark\",\n      onLeftClick: this.onCancel,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, \"\\u53D1\\u5E03\\u623F\\u6E90\"), React.createElement(_List, {\n      className: styles.header,\n      renderHeader: () => '基本信息',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }, React.createElement(Item, {\n      extra: community.name || '请选择小区名称',\n      arrow: \"horizontal\",\n      onClick: () => history.replace('/rent/search'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, \"\\u5C0F\\u533A\\u540D\\u79F0\"), React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u79DF\\u91D1/\\u6708\",\n      extra: \"\\uFFE5/\\u6708\",\n      type: \"number\",\n      value: price,\n      onChange: v => {\n        this.getInputVal('price', v);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }, \"\\u79DF\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\u91D1\"), React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u5EFA\\u7B51\\u9762\\u79EF\",\n      extra: \"\\u33A1\",\n      type: \"number\",\n      value: size,\n      onChange: v => {\n        this.getInputVal('size', v);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, \"\\u5EFA\\u7B51\\u9762\\u79EF\"), React.createElement(_Picker, {\n      data: roomTypeData,\n      value: [roomType],\n      cols: 1,\n      onChange: v => {\n        this.getInputVal('roomType', v[0]);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, React.createElement(Item, {\n      arrow: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, \"\\u6237\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\u578B\")), React.createElement(_Picker, {\n      data: floorData,\n      value: [floor],\n      cols: 1,\n      onChange: v => {\n        this.getInputVal('floor', v[0]);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, React.createElement(Item, {\n      arrow: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252\n      },\n      __self: this\n    }, \"\\u6240\\u5728\\u697C\\u5C42\")), React.createElement(_Picker, {\n      data: orientedData,\n      value: [oriented],\n      cols: 1,\n      onChange: v => {\n        this.getInputVal('oriented', v[0]);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254\n      },\n      __self: this\n    }, React.createElement(Item, {\n      arrow: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }, \"\\u671D\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\u5411\"))), React.createElement(_List, {\n      className: styles.title,\n      renderHeader: () => '房屋标题',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u6807\\u9898\\uFF08\\u4F8B\\u5982\\uFF1A\\u6574\\u79DF \\u5C0F\\u533A\\u540D 2\\u5BA4 5000\\u5143\\uFF09\",\n      value: title,\n      onChange: v => {\n        this.getInputVal('title', v);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270\n      },\n      __self: this\n    })), React.createElement(_List, {\n      className: styles.pics,\n      renderHeader: () => '房屋图像',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, React.createElement(_ImagePicker, {\n      files: tempSlides,\n      onChange: this.getImg,\n      multiple: true,\n      className: styles.imgpicker,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284\n      },\n      __self: this\n    })), React.createElement(_List, {\n      className: styles.supporting,\n      renderHeader: () => '房屋配置',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292\n      },\n      __self: this\n    }, React.createElement(HousePackage, {\n      select: true,\n      onSelect: this.selPack,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297\n      },\n      __self: this\n    })), React.createElement(_List, {\n      className: styles.desc,\n      renderHeader: () => '房屋描述',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, React.createElement(_TextareaItem, {\n      rows: 5,\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u623F\\u5C4B\\u63CF\\u8FF0\\u4FE1\\u606F\",\n      autoHeight: true,\n      value: description,\n      onChange: v => {\n        this.getInputVal('description', v);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305\n      },\n      __self: this\n    })), React.createElement(_Flex, {\n      className: styles.bottom,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316\n      },\n      __self: this\n    }, React.createElement(_Flex.Item, {\n      className: styles.cancel,\n      onClick: this.onCancel,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317\n      },\n      __self: this\n    }, \"\\u53D6\\u6D88\"), React.createElement(_Flex.Item, {\n      className: styles.confirm,\n      onClick: this.addHouse,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320\n      },\n      __self: this\n    }, \"\\u63D0\\u4EA4\")));\n  }\n\n}","map":{"version":3,"sources":["F:/百度云下载/React/hkzf/haokezufang/src/pages/Rent/Add/index.js"],"names":["React","Component","HousePackage","styles","uploadHouseImgs","pubHouse","alert","roomTypeData","label","value","orientedData","floorData","RentAdd","constructor","props","getInputVal","name","val","console","log","setState","selPack","selNames","supporting","join","getImg","files","operationType","index","tempSlides","onCancel","text","onPress","history","go","addHouse","title","description","oriented","price","roomType","size","floor","community","state","info","houseImg","length","fm","FormData","forEach","item","append","file","res","status","data","fail","otd","id","ores","success","push","backUrl","location","pathname","render","Item","root","navHeader","header","replace","v","pics","imgpicker","desc","bottom","cancel","confirm"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\n\r\nimport {\r\n  Flex,\r\n  List,\r\n  InputItem,\r\n  Picker,\r\n  ImagePicker,\r\n  TextareaItem,\r\n  Modal,\r\n  NavBar,\r\n  Icon,\r\n  Toast\r\n} from 'antd-mobile'\r\n\r\nimport HousePackage from '../../../components/HousePackage'\r\n\r\nimport styles from './index.module.css'\r\nimport { uploadHouseImgs, pubHouse } from '../../../utils/api/user'\r\n\r\nconst alert = Modal.alert\r\n\r\n// 房屋类型\r\nconst roomTypeData = [\r\n  { label: '一室', value: 'ROOM|d4a692e4-a177-37fd' },\r\n  { label: '二室', value: 'ROOM|d1a00384-5801-d5cd' },\r\n  { label: '三室', value: 'ROOM|20903ae0-c7bc-f2e2' },\r\n  { label: '四室', value: 'ROOM|ce2a5daa-811d-2f49' },\r\n  { label: '四室+', value: 'ROOM|2731c38c-5b19-ff7f' }\r\n]\r\n\r\n// 朝向：\r\nconst orientedData = [\r\n  { label: '东', value: 'ORIEN|141b98bf-1ad0-11e3' },\r\n  { label: '西', value: 'ORIEN|103fb3aa-e8b4-de0e' },\r\n  { label: '南', value: 'ORIEN|61e99445-e95e-7f37' },\r\n  { label: '北', value: 'ORIEN|caa6f80b-b764-c2df' },\r\n  { label: '东南', value: 'ORIEN|dfb1b36b-e0d1-0977' },\r\n  { label: '东北', value: 'ORIEN|67ac2205-7e0f-c057' },\r\n  { label: '西南', value: 'ORIEN|2354e89e-3918-9cef' },\r\n  { label: '西北', value: 'ORIEN|80795f1a-e32f-feb9' }\r\n]\r\n\r\n// 楼层\r\nconst floorData = [\r\n  { label: '高楼层', value: 'FLOOR|1' },\r\n  { label: '中楼层', value: 'FLOOR|2' },\r\n  { label: '低楼层', value: 'FLOOR|3' }\r\n]\r\n\r\nexport default class RentAdd extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    const { state = {} } = this.props.location;\r\n\r\n    this.state = {\r\n      // 临时图片地址\r\n      tempSlides: [],\r\n\r\n      // 小区的名称和id\r\n      community: {\r\n        name: state.name,\r\n        id: state.id\r\n      },\r\n      // 价格\r\n      price: '',\r\n      // 面积\r\n      size: '',\r\n      // 房屋类型\r\n      roomType: '',\r\n      // 楼层\r\n      floor: '',\r\n      // 朝向：\r\n      oriented: '',\r\n      // 房屋标题\r\n      title: '',\r\n      // 房屋图片\r\n      houseImg: '',\r\n      // 房屋配套：\r\n      supporting: '',\r\n      // 房屋描述\r\n      description: ''\r\n    }\r\n  }\r\n\r\n  // 获取输入的值\r\n  getInputVal = (name, val) => {\r\n    console.log(name, val)\r\n    this.setState({\r\n      [name]: val\r\n    })\r\n  }\r\n\r\n  // 选择配套\r\n  selPack = (selNames) => {\r\n    console.log(selNames);\r\n    this.setState({\r\n      supporting: selNames.join('|')\r\n    })\r\n  }\r\n\r\n  // 获取房屋图片\r\n  // files: Object, operationType: string, index: number\r\n  getImg = (files, operationType, index) => {\r\n    console.log(files, operationType, index)\r\n    this.setState({\r\n      tempSlides: files\r\n    })\r\n  }\r\n\r\n  // 取消编辑，返回上一页\r\n  onCancel = () => {\r\n    alert('提示', '放弃发布房源?', [\r\n      {\r\n        text: '放弃',\r\n        onPress: async () => this.props.history.go(-1)\r\n      },\r\n      {\r\n        text: '继续编辑'\r\n      }\r\n    ])\r\n  }\r\n\r\n  // 发布房源\r\n  addHouse = async () => {\r\n    const {\r\n      tempSlides,\r\n      title,\r\n      description,\r\n      oriented,\r\n      supporting,\r\n      price,\r\n      roomType,\r\n      size,\r\n      floor,\r\n      community\r\n    } = this.state;\r\n    // 处理边界\r\n    if (!title || !size || !price) {\r\n      return Toast.info('请输入房源基本信息！', 1)\r\n    }\r\n    // 上传图片，获取上传位置\r\n    let houseImg;\r\n    if (tempSlides.length) {\r\n      let fm = new FormData();\r\n      tempSlides.forEach((item) => fm.append('file', item.file));\r\n      let res = await uploadHouseImgs(fm);\r\n      console.log(res)\r\n      if (res.status === 200) {\r\n        houseImg = res.data.join('|')\r\n      } else {\r\n        Toast.fail(res.description, 2)\r\n      }\r\n    }\r\n    // 处理其它数据\r\n    const otd = {\r\n      title,\r\n      description,\r\n      houseImg,\r\n      oriented,\r\n      supporting,\r\n      price,\r\n      roomType,\r\n      size,\r\n      floor,\r\n      community: community.id\r\n    };\r\n    let ores = await pubHouse(otd)\r\n    console.log('form all data:', otd)\r\n    if (ores.status === 200) {\r\n      Toast.success('发布成功！', 1, () => {\r\n        this.props.history.push('/rent')\r\n      })\r\n    } else {\r\n      if (ores.status === 400) {\r\n        Toast.info('请重新登录！', 1, () => {\r\n          // 传入回跳地址\r\n          this.props.history.push('/login', { backUrl: this.props.location.pathname })\r\n        })\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  render() {\r\n    const Item = List.Item\r\n    const { history } = this.props\r\n    const {\r\n      community,\r\n      price,\r\n      size,\r\n      roomType,\r\n      floor,\r\n      oriented,\r\n      description,\r\n      tempSlides,\r\n      title\r\n    } = this.state\r\n\r\n    return (\r\n      <div className={styles.root}>\r\n        <NavBar\r\n          className={styles.navHeader}\r\n          icon={<Icon type=\"left\" />}\r\n          mode=\"dark\"\r\n          onLeftClick={this.onCancel}\r\n        >\r\n          发布房源\r\n        </NavBar>\r\n        <List\r\n          className={styles.header}\r\n          renderHeader={() => '基本信息'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          {/* 选择所在小区 */}\r\n          <Item\r\n            extra={community.name || '请选择小区名称'}\r\n            arrow=\"horizontal\"\r\n            onClick={() => history.replace('/rent/search')}\r\n          >\r\n            小区名称\r\n          </Item>\r\n          <InputItem placeholder=\"请输入租金/月\" extra=\"￥/月\" type=\"number\" value={price}\r\n            onChange={(v) => {\r\n              this.getInputVal('price', v)\r\n            }}>\r\n            租&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;金\r\n          </InputItem>\r\n          <InputItem placeholder=\"请输入建筑面积\" extra=\"㎡\" type=\"number\" value={size}\r\n            onChange={(v) => {\r\n              this.getInputVal('size', v)\r\n            }}\r\n          >\r\n            建筑面积\r\n          </InputItem>\r\n          <Picker data={roomTypeData} value={[roomType]} cols={1}\r\n            onChange={(v) => {\r\n              this.getInputVal('roomType', v[0])\r\n            }}\r\n          >\r\n            <Item arrow=\"horizontal\">\r\n              户&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型\r\n            </Item>\r\n          </Picker>\r\n\r\n          <Picker data={floorData} value={[floor]} cols={1}\r\n            onChange={(v) => {\r\n              this.getInputVal('floor', v[0])\r\n            }}\r\n          >\r\n            <Item arrow=\"horizontal\">所在楼层</Item>\r\n          </Picker>\r\n          <Picker data={orientedData} value={[oriented]} cols={1}\r\n            onChange={(v) => {\r\n              this.getInputVal('oriented', v[0])\r\n            }}\r\n          >\r\n            <Item arrow=\"horizontal\">\r\n              朝&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;向\r\n            </Item>\r\n          </Picker>\r\n        </List>\r\n\r\n        <List\r\n          className={styles.title}\r\n          renderHeader={() => '房屋标题'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <InputItem\r\n            placeholder=\"请输入标题（例如：整租 小区名 2室 5000元）\"\r\n            value={title}\r\n            onChange={(v) => {\r\n              this.getInputVal('title', v)\r\n            }}\r\n          />\r\n        </List>\r\n\r\n        <List\r\n          className={styles.pics}\r\n          renderHeader={() => '房屋图像'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <ImagePicker\r\n            files={tempSlides}\r\n            onChange={this.getImg}\r\n            multiple={true}\r\n            className={styles.imgpicker}\r\n          />\r\n        </List>\r\n\r\n        <List\r\n          className={styles.supporting}\r\n          renderHeader={() => '房屋配置'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <HousePackage select onSelect={this.selPack} />\r\n        </List>\r\n\r\n        <List\r\n          className={styles.desc}\r\n          renderHeader={() => '房屋描述'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <TextareaItem\r\n            rows={5}\r\n            placeholder=\"请输入房屋描述信息\"\r\n            autoHeight\r\n            value={description}\r\n            onChange={(v) => {\r\n              this.getInputVal('description', v)\r\n            }}\r\n          />\r\n        </List>\r\n\r\n        <Flex className={styles.bottom}>\r\n          <Flex.Item className={styles.cancel} onClick={this.onCancel}>\r\n            取消\r\n          </Flex.Item>\r\n          <Flex.Item className={styles.confirm} onClick={this.addHouse}>\r\n            提交\r\n          </Flex.Item>\r\n        </Flex>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}